import React, { useState, useEffect } from 'react'
import { useNavigate } from 'react-router-dom'
import useAuth from '../hooks/useAuth'
import { fetchCountries, fetchStates, fetchCities } from '../services/locationService'
import './UploadProperty.css'

const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5001'

export default function UploadProperty() {
  const navigate = useNavigate()
  const auth = useAuth()
  const [currentStep, setCurrentStep] = useState(1)
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    price: '',
    type: '',
    address: '',
    country: '',
    state: '',
    city: '',
    zipCode: '',
    beds: '',
    baths: '',
    area: '',
    yearBuilt: '',
    amenities: [],
    images: [],
    featured: false,
    instagram: '',
    youtube: ''
  })

  const [previewImages, setPreviewImages] = useState([])
  const [dragActive, setDragActive] = useState(false)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState(null)
  const [success, setSuccess] = useState(false)
  const [availableStates, setAvailableStates] = useState([])
  const [availableCities, setAvailableCities] = useState([])
  
  // API data from CountryStateCity API
  const [countries, setCountries] = useState([])
  const [loadingLocations, setLoadingLocations] = useState(false)
  const [selectedCountryCode, setSelectedCountryCode] = useState('')
  const [selectedStateCode, setSelectedStateCode] = useState('')
  
  // Search/filter states for dropdowns
  const [countrySearch, setCountrySearch] = useState('')
  const [stateSearch, setStateSearch] = useState('')
  const [citySearch, setCitySearch] = useState('')
  const [showCountryDropdown, setShowCountryDropdown] = useState(false)
  const [showStateDropdown, setShowStateDropdown] = useState(false)
  const [showCityDropdown, setShowCityDropdown] = useState(false)

  // Verify authentication on mount
  useEffect(() => {
    const verifyAuth = async () => {
      const token = localStorage.getItem('token')
      if (!token) {
        setError('Please login to upload a property')
        setTimeout(() => navigate('/signin'), 2000)
        return
      }

      // Verify token is valid
      try {
        const response = await fetch(`${API_URL}/api/auth/profile`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        })

        if (!response.ok) {
          setError('Your session has expired. Please login again.')
          localStorage.removeItem('token')
          localStorage.removeItem('user')
          auth.logout()
          setTimeout(() => navigate('/signin'), 2000)
        }
      } catch (err) {
        console.error('Auth verification error:', err)
        setError('Authentication error. Please login again.')
        setTimeout(() => navigate('/signin'), 2000)
      }
    }

    verifyAuth()
  }, [navigate, auth])

  // Close dropdowns when clicking outside
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (!event.target.closest('.searchable-dropdown')) {
        setShowCountryDropdown(false)
        setShowStateDropdown(false)
        setShowCityDropdown(false)
        setCountrySearch('')
        setStateSearch('')
        setCitySearch('')
      }
    }

    document.addEventListener('mousedown', handleClickOutside)
    return () => document.removeEventListener('mousedown', handleClickOutside)
  }, [])

  const propertyTypes = ['House', 'Apartment', 'Cottage', 'Penthouse', 'Villa', 'Loft', 'Condo', 'Townhouse']
  
  const amenitiesList = [
    'Pool', 'Garage', 'Garden', 'Gym', 'Smart Home', 'Fireplace',
    'Balcony', 'Parking', 'Security System', 'Air Conditioning',
    'Heating', 'Dishwasher', 'Washer/Dryer', 'Hardwood Floors',
    'High Ceilings', 'Walk-in Closet', 'Pet Friendly', 'Furnished'
  ]

  // Load countries from API on mount
  useEffect(() => {
    const loadCountries = async () => {
      try {
        setLoadingLocations(true)
        const countriesData = await fetchCountries()
        setCountries(countriesData)
      } catch (error) {
        console.error('Failed to load countries:', error)
        setError('Failed to load countries. Please refresh the page.')
      } finally {
        setLoadingLocations(false)
      }
    }
    
    loadCountries()
  }, [])

  // Handle country change - fetch states from API
  const handleCountryChange = async (e) => {
    const countryName = e.target.value
    
    // Find country code from name
    const selectedCountry = countries.find(c => c.name === countryName)
    const countryCode = selectedCountry?.iso2 || ''
    
    setFormData(prev => ({
      ...prev,
      country: countryName,
      state: '',
      city: ''
    }))
    
    setSelectedCountryCode(countryCode)
    setSelectedStateCode('')
    setAvailableCities([])
    
    if (countryCode) {
      try {
        setLoadingLocations(true)
        const statesData = await fetchStates(countryCode)
        setAvailableStates(statesData)
      } catch (error) {
        console.error('Failed to load states:', error)
        setAvailableStates([])
      } finally {
        setLoadingLocations(false)
      }
    } else {
      setAvailableStates([])
    }
  }

  // Handle state change - fetch cities from API
  const handleStateChange = async (e) => {
    const stateName = e.target.value
    
    // Find state code from name
    const selectedState = availableStates.find(s => s.name === stateName)
    const stateCode = selectedState?.iso2 || ''
    
    setFormData(prev => ({
      ...prev,
      state: stateName,
      city: ''
    }))
    
    setSelectedStateCode(stateCode)
    
    if (selectedCountryCode && stateCode) {
      try {
        setLoadingLocations(true)
        const citiesData = await fetchCities(selectedCountryCode, stateCode)
        setAvailableCities(citiesData)
      } catch (error) {
        console.error('Failed to load cities:', error)
        setAvailableCities([])
      } finally {
        setLoadingLocations(false)
      }
    } else {
      setAvailableCities([])
    }
  }

  // Handle city change
  const handleCityChange = (e) => {
    setFormData(prev => ({
      ...prev,
      city: e.target.value
    }))
  }

  // const handleInputChange = (e) => {
  //     'Alabama': ['Birmingham', 'Montgomery', 'Mobile', 'Huntsville', 'Tuscaloosa', 'Hoover', 'Dothan', 'Auburn', 'Decatur', 'Madison', 'Florence', 'Gadsden', 'Vestavia Hills', 'Prattville', 'Phenix City', 'Alabaster', 'Bessemer', 'Enterprise', 'Opelika', 'Homewood'],
  //     'Alaska': ['Anchorage', 'Juneau', 'Fairbanks', 'Sitka', 'Ketchikan', 'Wasilla', 'Kenai', 'Kodiak', 'Bethel', 'Palmer', 'Homer', 'Soldotna', 'Barrow', 'Valdez', 'Nome'],
  //     'Arizona': ['Phoenix', 'Tucson', 'Mesa', 'Chandler', 'Scottsdale', 'Glendale', 'Gilbert', 'Tempe', 'Peoria', 'Surprise', 'Yuma', 'Avondale', 'Flagstaff', 'Goodyear', 'Lake Havasu City', 'Buckeye', 'Casa Grande', 'Sierra Vista', 'Maricopa', 'Oro Valley'],
  //     'Arkansas': ['Little Rock', 'Fort Smith', 'Fayetteville', 'Springdale', 'Jonesboro', 'North Little Rock', 'Conway', 'Rogers', 'Pine Bluff', 'Bentonville', 'Hot Springs', 'Benton', 'Sherwood', 'Texarkana', 'Russellville', 'Jacksonville', 'Bella Vista', 'Paragould', 'Cabot', 'Searcy'],
  //     'California': ['Los Angeles', 'San Francisco', 'San Diego', 'Sacramento', 'San Jose', 'Fresno', 'Oakland', 'Long Beach', 'Bakersfield', 'Anaheim', 'Santa Ana', 'Riverside', 'Stockton', 'Irvine', 'Chula Vista', 'Fremont', 'San Bernardino', 'Modesto', 'Fontana', 'Santa Clarita', 'Oxnard', 'Moreno Valley', 'Glendale', 'Huntington Beach', 'Santa Rosa', 'Oceanside', 'Garden Grove', 'Ontario', 'Rancho Cucamonga', 'Elk Grove', 'Corona', 'Lancaster', 'Palmdale', 'Salinas', 'Pomona', 'Hayward', 'Sunnyvale', 'Pasadena', 'Escondido', 'Torrance', 'Orange', 'Fullerton', 'Thousand Oaks', 'Visalia', 'Simi Valley', 'Concord', 'Roseville', 'Santa Clara', 'Vallejo', 'Berkeley'],
  //     'Colorado': ['Denver', 'Colorado Springs', 'Aurora', 'Fort Collins', 'Lakewood', 'Thornton', 'Arvada', 'Westminster', 'Pueblo', 'Centennial', 'Boulder', 'Greeley', 'Longmont', 'Loveland', 'Grand Junction', 'Broomfield', 'Castle Rock', 'Commerce City', 'Parker', 'Littleton'],
  //     'Connecticut': ['Hartford', 'New Haven', 'Stamford', 'Bridgeport', 'Waterbury', 'Norwalk', 'Danbury', 'New Britain', 'Bristol', 'Meriden', 'Milford', 'West Haven', 'Middletown', 'Norwich', 'Shelton', 'Torrington', 'Stratford', 'East Hartford', 'Groton', 'Manchester'],
  //     'Delaware': ['Wilmington', 'Dover', 'Newark', 'Middletown', 'Smyrna', 'Milford', 'Seaford', 'Georgetown', 'Elsmere', 'New Castle', 'Millsboro', 'Laurel', 'Harrington', 'Camden', 'Clayton', 'Lewes', 'Milton', 'Selbyville', 'Bridgeville', 'Delmar'],
  //     'Florida': ['Miami', 'Orlando', 'Tampa', 'Jacksonville', 'Fort Lauderdale', 'Tallahassee', 'St. Petersburg', 'Hialeah', 'Port St. Lucie', 'Cape Coral', 'Pembroke Pines', 'Hollywood', 'Miramar', 'Coral Springs', 'Clearwater', 'Miami Gardens', 'Palm Bay', 'Pompano Beach', 'West Palm Beach', 'Lakeland', 'Davie', 'Miami Beach', 'Sunrise', 'Plantation', 'Boca Raton', 'Deltona', 'Largo', 'Deerfield Beach', 'Palm Coast', 'Melbourne'],
  //     'Georgia': ['Atlanta', 'Augusta', 'Columbus', 'Macon', 'Savannah', 'Athens', 'Sandy Springs', 'Roswell', 'Johns Creek', 'Albany', 'Warner Robins', 'Alpharetta', 'Marietta', 'Valdosta', 'Smyrna', 'Dunwoody', 'Rome', 'East Point', 'Milton', 'Gainesville'],
  //     'Hawaii': ['Honolulu', 'Pearl City', 'Hilo', 'Kailua', 'Waipahu', 'Kaneohe', 'Mililani', 'Kahului', 'Ewa Gentry', 'Mililani Town', 'Kihei', 'Makakilo', 'Wahiawa', 'Schofield Barracks', 'Halawa', 'Waimalu', 'Nanakuli', 'Waianae', 'Wailuku', 'Kapaa'],
  //     'Idaho': ['Boise', 'Meridian', 'Nampa', 'Idaho Falls', 'Pocatello', 'Caldwell', 'Coeur d\'Alene', 'Twin Falls', 'Lewiston', 'Post Falls', 'Rexburg', 'Eagle', 'Moscow', 'Kuna', 'Ammon', 'Chubbuck', 'Hayden', 'Mountain Home', 'Blackfoot', 'Garden City'],
  //     'Illinois': ['Chicago', 'Aurora', 'Naperville', 'Joliet', 'Rockford', 'Springfield', 'Elgin', 'Peoria', 'Champaign', 'Waukegan', 'Cicero', 'Bloomington', 'Arlington Heights', 'Evanston', 'Decatur', 'Schaumburg', 'Bolingbrook', 'Palatine', 'Skokie', 'Des Plaines', 'Orland Park', 'Tinley Park', 'Oak Lawn', 'Berwyn', 'Mount Prospect', 'Normal', 'Wheaton', 'Hoffman Estates', 'Oak Park', 'Downers Grove'],
  //     'Indiana': ['Indianapolis', 'Fort Wayne', 'Evansville', 'South Bend', 'Carmel', 'Fishers', 'Bloomington', 'Hammond', 'Gary', 'Muncie', 'Lafayette', 'Terre Haute', 'Kokomo', 'Anderson', 'Noblesville', 'Greenwood', 'Elkhart', 'Mishawaka', 'Lawrence', 'Jeffersonville'],
  //     'Iowa': ['Des Moines', 'Cedar Rapids', 'Davenport', 'Sioux City', 'Iowa City', 'Waterloo', 'Council Bluffs', 'Ames', 'West Des Moines', 'Dubuque', 'Ankeny', 'Urbandale', 'Cedar Falls', 'Marion', 'Bettendorf', 'Mason City', 'Marshalltown', 'Clinton', 'Burlington', 'Ottumwa'],
  //     'Kansas': ['Wichita', 'Overland Park', 'Kansas City', 'Topeka', 'Olathe', 'Lawrence', 'Shawnee', 'Manhattan', 'Lenexa', 'Salina', 'Hutchinson', 'Leavenworth', 'Leawood', 'Dodge City', 'Garden City', 'Junction City', 'Emporia', 'Derby', 'Prairie Village', 'Hays'],
  //     'Kentucky': ['Louisville', 'Lexington', 'Bowling Green', 'Owensboro', 'Covington', 'Richmond', 'Georgetown', 'Florence', 'Elizabethtown', 'Nicholasville', 'Henderson', 'Jeffersontown', 'Frankfort', 'Paducah', 'Hopkinsville', 'Independence', 'Radcliff', 'Ashland', 'Madisonville', 'Winchester'],
  //     'Louisiana': ['New Orleans', 'Baton Rouge', 'Shreveport', 'Lafayette', 'Lake Charles', 'Kenner', 'Bossier City', 'Monroe', 'Alexandria', 'Houma', 'Marrero', 'Laplace', 'New Iberia', 'Slidell', 'Prairieville', 'Metairie', 'Chalmette', 'Ruston', 'Hammond', 'Sulphur'],
  //     'Maine': ['Portland', 'Lewiston', 'Bangor', 'South Portland', 'Auburn', 'Biddeford', 'Sanford', 'Saco', 'Augusta', 'Westbrook', 'Waterville', 'Presque Isle', 'Brunswick', 'Scarborough', 'Gorham', 'Windham', 'Bath', 'Old Town', 'Caribou', 'Kennebunk'],
  //     'Maryland': ['Baltimore', 'Columbia', 'Germantown', 'Silver Spring', 'Waldorf', 'Glen Burnie', 'Frederick', 'Ellicott City', 'Dundalk', 'Rockville', 'Bethesda', 'Gaithersburg', 'Bowie', 'Hagerstown', 'Annapolis', 'Towson', 'Salisbury', 'Carney', 'Parkville', 'Potomac'],
  //     'Massachusetts': ['Boston', 'Worcester', 'Springfield', 'Cambridge', 'Lowell', 'Brockton', 'Quincy', 'Lynn', 'New Bedford', 'Fall River', 'Newton', 'Lawrence', 'Somerville', 'Framingham', 'Haverhill', 'Waltham', 'Malden', 'Brookline', 'Plymouth', 'Medford', 'Taunton', 'Revere', 'Peabody', 'Methuen', 'Barnstable', 'Pittsfield', 'Attleboro', 'Everett', 'Salem', 'Westfield'],
  //     'Michigan': ['Detroit', 'Grand Rapids', 'Warren', 'Sterling Heights', 'Ann Arbor', 'Lansing', 'Flint', 'Dearborn', 'Livonia', 'Clinton', 'Canton', 'Westland', 'Troy', 'Farmington Hills', 'Macomb', 'Kalamazoo', 'Shelby', 'Wyoming', 'Southfield', 'Rochester Hills', 'Taylor', 'St. Clair Shores', 'Pontiac', 'Royal Oak', 'Novi', 'Dearborn Heights', 'Battle Creek', 'Saginaw', 'Kentwood', 'East Lansing'],
  //     'Minnesota': ['Minneapolis', 'St. Paul', 'Rochester', 'Duluth', 'Bloomington', 'Brooklyn Park', 'Plymouth', 'St. Cloud', 'Eagan', 'Woodbury', 'Maple Grove', 'Eden Prairie', 'Coon Rapids', 'Burnsville', 'Blaine', 'Lakeville', 'Minnetonka', 'Apple Valley', 'Edina', 'St. Louis Park'],
  //     'Mississippi': ['Jackson', 'Gulfport', 'Southaven', 'Hattiesburg', 'Biloxi', 'Meridian', 'Tupelo', 'Olive Branch', 'Greenville', 'Horn Lake', 'Pearl', 'Clinton', 'Madison', 'Ridgeland', 'Starkville', 'Columbus', 'Vicksburg', 'Pascagoula', 'Brandon', 'Oxford'],
  //     'Missouri': ['Kansas City', 'St. Louis', 'Springfield', 'Columbia', 'Independence', 'Lee\'s Summit', 'O\'Fallon', 'St. Joseph', 'St. Charles', 'Blue Springs', 'St. Peters', 'Florissant', 'Joplin', 'Chesterfield', 'Jefferson City', 'Cape Girardeau', 'Oakville', 'Wildwood', 'University City', 'Ballwin'],
  //     'Montana': ['Billings', 'Missoula', 'Great Falls', 'Bozeman', 'Butte', 'Helena', 'Kalispell', 'Havre', 'Anaconda', 'Miles City', 'Belgrade', 'Livingston', 'Laurel', 'Whitefish', 'Lewistown', 'Sidney', 'Glendive', 'Columbia Falls', 'Polson', 'Hamilton'],
  //     'Nebraska': ['Omaha', 'Lincoln', 'Bellevue', 'Grand Island', 'Kearney', 'Fremont', 'Hastings', 'Norfolk', 'Columbus', 'Papillion', 'North Platte', 'La Vista', 'Scottsbluff', 'South Sioux City', 'Beatrice', 'Lexington', 'Alliance', 'Gering', 'Blair', 'York'],
  //     'Nevada': ['Las Vegas', 'Henderson', 'Reno', 'North Las Vegas', 'Sparks', 'Carson City', 'Fernley', 'Elko', 'Mesquite', 'Boulder City', 'Fallon', 'Winnemucca', 'West Wendover', 'Ely', 'Yerington', 'Carlin', 'Lovelock', 'Wells', 'Caliente', 'Tonopah'],
  //     'New Hampshire': ['Manchester', 'Nashua', 'Concord', 'Derry', 'Rochester', 'Salem', 'Dover', 'Merrimack', 'Londonderry', 'Hudson', 'Keene', 'Bedford', 'Portsmouth', 'Goffstown', 'Laconia', 'Hampton', 'Milford', 'Durham', 'Exeter', 'Windham'],
  //     'New Jersey': ['Newark', 'Jersey City', 'Paterson', 'Elizabeth', 'Edison', 'Woodbridge', 'Lakewood', 'Toms River', 'Hamilton', 'Trenton', 'Clifton', 'Camden', 'Brick', 'Cherry Hill', 'Passaic', 'Union City', 'Old Bridge', 'Bayonne', 'Franklin', 'Vineland', 'North Bergen', 'Union', 'Piscataway', 'New Brunswick', 'Jackson', 'Wayne', 'Irvington', 'Parsippany-Troy Hills', 'Howell', 'Perth Amboy'],
  //     'New Mexico': ['Albuquerque', 'Las Cruces', 'Rio Rancho', 'Santa Fe', 'Roswell', 'Farmington', 'Clovis', 'Hobbs', 'Alamogordo', 'Carlsbad', 'Gallup', 'Deming', 'Los Alamos', 'Chaparral', 'Sunland Park', 'Las Vegas', 'Portales', 'Artesia', 'Lovington', 'Silver City'],
  //     'New York': ['New York City', 'Buffalo', 'Rochester', 'Albany', 'Syracuse', 'Yonkers', 'Bronx', 'Brooklyn', 'Manhattan', 'Queens', 'Staten Island', 'New Rochelle', 'Mount Vernon', 'Schenectady', 'Utica', 'White Plains', 'Hempstead', 'Troy', 'Niagara Falls', 'Binghamton', 'Freeport', 'Valley Stream', 'Long Beach', 'Spring Valley', 'Rome', 'North Tonawanda', 'Jamestown', 'Poughkeepsie', 'Ithaca', 'Middletown'],
  //     'North Carolina': ['Charlotte', 'Raleigh', 'Greensboro', 'Durham', 'Winston-Salem', 'Fayetteville', 'Cary', 'Wilmington', 'High Point', 'Concord', 'Greenville', 'Asheville', 'Gastonia', 'Jacksonville', 'Chapel Hill', 'Rocky Mount', 'Burlington', 'Huntersville', 'Wilson', 'Kannapolis'],
  //     'North Dakota': ['Fargo', 'Bismarck', 'Grand Forks', 'Minot', 'West Fargo', 'Williston', 'Dickinson', 'Mandan', 'Jamestown', 'Wahpeton', 'Devils Lake', 'Valley City', 'Grafton', 'Rugby', 'Beulah', 'Watford City', 'Lincoln', 'Horace', 'Casselton', 'Lisbon'],
  //     'Ohio': ['Columbus', 'Cleveland', 'Cincinnati', 'Toledo', 'Akron', 'Dayton', 'Parma', 'Canton', 'Youngstown', 'Lorain', 'Hamilton', 'Springfield', 'Kettering', 'Elyria', 'Lakewood', 'Cuyahoga Falls', 'Middletown', 'Euclid', 'Newark', 'Mansfield', 'Mentor', 'Beavercreek', 'Cleveland Heights', 'Strongsville', 'Dublin', 'Fairfield', 'Findlay', 'Warren', 'Lancaster', 'Lima'],
  //     'Oklahoma': ['Oklahoma City', 'Tulsa', 'Norman', 'Broken Arrow', 'Edmond', 'Lawton', 'Moore', 'Midwest City', 'Enid', 'Stillwater', 'Muskogee', 'Bartlesville', 'Owasso', 'Shawnee', 'Yukon', 'Ardmore', 'Ponca City', 'Duncan', 'Del City', 'Sapulpa'],
  //     'Oregon': ['Portland', 'Salem', 'Eugene', 'Gresham', 'Hillsboro', 'Beaverton', 'Bend', 'Medford', 'Springfield', 'Corvallis', 'Albany', 'Tigard', 'Lake Oswego', 'Keizer', 'Grants Pass', 'Oregon City', 'McMinnville', 'Redmond', 'Tualatin', 'West Linn'],
  //     'Pennsylvania': ['Philadelphia', 'Pittsburgh', 'Allentown', 'Erie', 'Reading', 'Scranton', 'Bethlehem', 'Lancaster', 'Harrisburg', 'Altoona', 'York', 'State College', 'Wilkes-Barre', 'Chester', 'Williamsport', 'Easton', 'Lebanon', 'Hazleton', 'New Castle', 'Johnstown', 'McKeesport', 'Hermitage', 'Greensburg', 'Pottstown', 'Norristown', 'Monroeville', 'Plum', 'Bethel Park', 'Lower Merion', 'Abington'],
  //     'Rhode Island': ['Providence', 'Warwick', 'Cranston', 'Pawtucket', 'East Providence', 'Woonsocket', 'Coventry', 'Cumberland', 'North Providence', 'South Kingstown', 'West Warwick', 'Johnston', 'North Kingstown', 'Newport', 'Bristol', 'Westerly', 'Smithfield', 'Lincoln', 'Central Falls', 'Portsmouth'],
  //     'South Carolina': ['Charleston', 'Columbia', 'North Charleston', 'Mount Pleasant', 'Rock Hill', 'Greenville', 'Summerville', 'Sumter', 'Goose Creek', 'Hilton Head Island', 'Florence', 'Spartanburg', 'Myrtle Beach', 'Aiken', 'Anderson', 'Greer', 'Mauldin', 'Greenwood', 'North Augusta', 'Easley'],
  //     'South Dakota': ['Sioux Falls', 'Rapid City', 'Aberdeen', 'Brookings', 'Watertown', 'Mitchell', 'Yankton', 'Pierre', 'Huron', 'Spearfish', 'Vermillion', 'Brandon', 'Box Elder', 'Madison', 'Sturgis', 'Belle Fourche', 'Harrisburg', 'Tea', 'Dell Rapids', 'Lennox'],
  //     'Tennessee': ['Nashville', 'Memphis', 'Knoxville', 'Chattanooga', 'Clarksville', 'Murfreesboro', 'Franklin', 'Johnson City', 'Jackson', 'Bartlett', 'Hendersonville', 'Kingsport', 'Collierville', 'Smyrna', 'Cleveland', 'Brentwood', 'Germantown', 'Columbia', 'Spring Hill', 'La Vergne'],
  //     'Texas': ['Houston', 'Dallas', 'Austin', 'San Antonio', 'Fort Worth', 'El Paso', 'Arlington', 'Corpus Christi', 'Plano', 'Laredo', 'Lubbock', 'Garland', 'Irving', 'Amarillo', 'Grand Prairie', 'Brownsville', 'McKinney', 'Frisco', 'Pasadena', 'Mesquite', 'Killeen', 'McAllen', 'Waco', 'Carrollton', 'Denton', 'Midland', 'Abilene', 'Beaumont', 'Round Rock', 'Odessa', 'Wichita Falls', 'Richardson', 'Tyler', 'Lewisville', 'College Station', 'Pearland', 'San Angelo', 'Allen', 'League City', 'Sugar Land'],
  //     'Utah': ['Salt Lake City', 'West Valley City', 'Provo', 'West Jordan', 'Orem', 'Sandy', 'Ogden', 'St. George', 'Layton', 'Taylorsville', 'South Jordan', 'Lehi', 'Logan', 'Murray', 'Draper', 'Bountiful', 'Riverton', 'Roy', 'Spanish Fork', 'Pleasant Grove'],
  //     'Vermont': ['Burlington', 'South Burlington', 'Rutland', 'Barre', 'Montpelier', 'Winooski', 'St. Albans', 'Newport', 'Vergennes', 'Essex Junction', 'Hartford', 'Middlebury', 'Springfield', 'Bennington', 'Brattleboro', 'Colchester', 'Milton', 'Williston', 'St. Johnsbury', 'Shelburne'],
  //     'Virginia': ['Virginia Beach', 'Norfolk', 'Chesapeake', 'Richmond', 'Newport News', 'Alexandria', 'Hampton', 'Roanoke', 'Portsmouth', 'Suffolk', 'Lynchburg', 'Harrisonburg', 'Leesburg', 'Charlottesville', 'Danville', 'Blacksburg', 'Manassas', 'Petersburg', 'Fredericksburg', 'Winchester'],
  //     'Washington': ['Seattle', 'Spokane', 'Tacoma', 'Vancouver', 'Bellevue', 'Kent', 'Everett', 'Renton', 'Spokane Valley', 'Federal Way', 'Yakima', 'Kirkland', 'Bellingham', 'Kennewick', 'Auburn', 'Pasco', 'Marysville', 'Lakewood', 'Redmond', 'Shoreline', 'Richland', 'Sammamish', 'Burien', 'Olympia', 'Lacey', 'Edmonds', 'Bremerton', 'Puyallup', 'Lynnwood', 'Bothell'],
  //     'West Virginia': ['Charleston', 'Huntington', 'Morgantown', 'Parkersburg', 'Wheeling', 'Weirton', 'Fairmont', 'Martinsburg', 'Beckley', 'Clarksburg', 'South Charleston', 'St. Albans', 'Vienna', 'Bluefield', 'Moundsville', 'Bridgeport', 'Dunbar', 'Oak Hill', 'Elkins', 'Princeton'],
  //     'Wisconsin': ['Milwaukee', 'Madison', 'Green Bay', 'Kenosha', 'Racine', 'Appleton', 'Waukesha', 'Eau Claire', 'Oshkosh', 'Janesville', 'West Allis', 'La Crosse', 'Sheboygan', 'Wauwatosa', 'Fond du Lac', 'New Berlin', 'Wausau', 'Brookfield', 'Greenfield', 'Beloit'],
  //     'Wyoming': ['Cheyenne', 'Casper', 'Laramie', 'Gillette', 'Rock Springs', 'Sheridan', 'Green River', 'Evanston', 'Riverton', 'Jackson', 'Cody', 'Rawlins', 'Lander', 'Torrington', 'Powell', 'Douglas', 'Worland', 'Buffalo', 'Newcastle', 'Wheatland']
  //   },
  //   'India': {
  //     'Andhra Pradesh': ['Visakhapatnam', 'Vijayawada', 'Guntur', 'Nellore', 'Tirupati', 'Kakinada', 'Rajahmundry', 'Kadapa', 'Anantapur', 'Eluru', 'Ongole', 'Kurnool', 'Machilipatnam', 'Srikakulam', 'Vizianagaram', 'Chittoor', 'Bhimavaram', 'Tenali', 'Proddatur', 'Hindupur'],
  //     'Arunachal Pradesh': ['Itanagar', 'Naharlagun', 'Pasighat', 'Namsai', 'Tezu', 'Tawang', 'Ziro', 'Bomdila', 'Seppa', 'Changlang', 'Along', 'Roing', 'Daporijo', 'Aalo', 'Khonsa'],
  //     'Assam': ['Guwahati', 'Silchar', 'Dibrugarh', 'Jorhat', 'Nagaon', 'Tinsukia', 'Tezpur', 'Bongaigaon', 'Dhubri', 'Diphu', 'North Lakhimpur', 'Karimganj', 'Sivasagar', 'Goalpara', 'Barpeta', 'Golaghat', 'Haflong', 'Mangaldoi', 'Lumding', 'Hailakandi'],
  //     'Bihar': ['Patna', 'Gaya', 'Bhagalpur', 'Muzaffarpur', 'Purnia', 'Darbhanga', 'Bihar Sharif', 'Arrah', 'Begusarai', 'Katihar', 'Munger', 'Chapra', 'Danapur', 'Saharsa', 'Hajipur', 'Sasaram', 'Dehri', 'Siwan', 'Motihari', 'Nawada'],
  //     'Chhattisgarh': ['Raipur', 'Bhilai', 'Bilaspur', 'Korba', 'Durg', 'Rajnandgaon', 'Jagdalpur', 'Raigarh', 'Ambikapur', 'Mahasamund', 'Dhamtari', 'Chirmiri', 'Bhatapara', 'Dalli-Rajhara', 'Naila Janjgir', 'Tilda Newra', 'Mungeli', 'Manendragarh', 'Sakti', 'Kondagaon'],
  //     'Goa': ['Panaji', 'Margao', 'Vasco da Gama', 'Mapusa', 'Ponda', 'Bicholim', 'Curchorem', 'Sanquelim', 'Cuncolim', 'Valpoi', 'Pernem', 'Quepem', 'Canacona', 'Sanguem', 'Aldona'],
  //     'Gujarat': ['Ahmedabad', 'Surat', 'Vadodara', 'Rajkot', 'Bhavnagar', 'Jamnagar', 'Gandhinagar', 'Junagadh', 'Gandhidham', 'Anand', 'Navsari', 'Morbi', 'Nadiad', 'Surendranagar', 'Bharuch', 'Mehsana', 'Bhuj', 'Porbander', 'Palanpur', 'Valsad', 'Vapi', 'Godhra', 'Bhavnagar', 'Ankleshwar', 'Botad', 'Amreli', 'Deesa', 'Jetpur', 'Gondal', 'Veraval'],
  //     'Haryana': ['Faridabad', 'Gurgaon', 'Rohtak', 'Hisar', 'Panipat', 'Karnal', 'Sonipat', 'Yamunanagar', 'Panchkula', 'Bhiwani', 'Ambala', 'Sirsa', 'Bahadurgarh', 'Jind', 'Thanesar', 'Kaithal', 'Rewari', 'Palwal', 'Pundri', 'Kosli'],
  //     'Himachal Pradesh': ['Shimla', 'Dharamshala', 'Solan', 'Mandi', 'Kullu', 'Palampur', 'Baddi', 'Nahan', 'Una', 'Hamirpur', 'Kangra', 'Bilaspur', 'Chamba', 'Sundernagar', 'Jogindernagar', 'Manali', 'Nalagarh', 'Parwanoo', 'Arki', 'Rampur'],
  //     'Jharkhand': ['Ranchi', 'Jamshedpur', 'Dhanbad', 'Bokaro', 'Deoghar', 'Phusro', 'Hazaribagh', 'Giridih', 'Ramgarh', 'Medininagar', 'Chirkunda', 'Jharia', 'Chaibasa', 'Dumka', 'Sahibganj', 'Ghatshila', 'Godda', 'Koderma', 'Lohardaga', 'Pakur'],
  //     'Karnataka': ['Bangalore', 'Mysore', 'Mangalore', 'Hubli', 'Belgaum', 'Gulbarga', 'Bellary', 'Davangere', 'Tumkur', 'Shimoga', 'Bijapur', 'Bidar', 'Raichur', 'Hassan', 'Udupi', 'Mandya', 'Chitradurga', 'Kolar', 'Bagalkot', 'Gadag', 'Hospet', 'Karwar', 'Ranebennur', 'Chikmagalur', 'Sirsi', 'Bhadravati', 'Dharwad', 'Haveri', 'Yadgir', 'Koppal'],
  //     'Kerala': ['Thiruvananthapuram', 'Kochi', 'Kozhikode', 'Thrissur', 'Kollam', 'Palakkad', 'Alappuzha', 'Malappuram', 'Kannur', 'Kasaragod', 'Kottayam', 'Pathanamthitta', 'Idukki', 'Wayanad', 'Thalassery', 'Ponnani', 'Vatakara', 'Kanhangad', 'Payyanur', 'Koyilandy', 'Parappanangadi', 'Kalamassery', 'Neyyattinkara', 'Kayamkulam', 'Nedumangad', 'Kannur', 'Tirur', 'Kottakkal', 'Manjeri', 'Changanassery'],
  //     'Madhya Pradesh': ['Bhopal', 'Indore', 'Jabalpur', 'Gwalior', 'Ujjain', 'Sagar', 'Dewas', 'Satna', 'Ratlam', 'Rewa', 'Katni', 'Singrauli', 'Burhanpur', 'Khandwa', 'Morena', 'Bhind', 'Chhindwara', 'Guna', 'Shivpuri', 'Vidisha', 'Damoh', 'Mandsaur', 'Khargone', 'Neemuch', 'Pithampur', 'Hoshangabad', 'Itarsi', 'Sehore', 'Betul', 'Seoni'],
  //     'Maharashtra': ['Mumbai', 'Pune', 'Nagpur', 'Nashik', 'Thane', 'Aurangabad', 'Solapur', 'Kalyan-Dombivli', 'Vasai-Virar', 'Navi Mumbai', 'Amravati', 'Kolhapur', 'Sangli', 'Jalgaon', 'Akola', 'Latur', 'Dhule', 'Ahmednagar', 'Chandrapur', 'Parbhani', 'Ichalkaranji', 'Jalna', 'Ambernath', 'Bhiwandi', 'Panvel', 'Mira-Bhayandar', 'Ulhasnagar', 'Malegaon', 'Nanded', 'Satara', 'Wardha', 'Yavatmal', 'Bid', 'Gondia', 'Beed', 'Osmanabad'],
  //     'Manipur': ['Imphal', 'Thoubal', 'Bishnupur', 'Churachandpur', 'Kakching', 'Ukhrul', 'Senapati', 'Tamenglong', 'Jiribam', 'Moreh', 'Mayang Imphal', 'Yairipok', 'Wangjing', 'Andro', 'Nambol'],
  //     'Meghalaya': ['Shillong', 'Tura', 'Nongstoin', 'Jowai', 'Baghmara', 'Williamnagar', 'Nongpoh', 'Mairang', 'Resubelpara', 'Mawkyrwat', 'Ampati', 'Cherrapunji', 'Mairang', 'Khliehriat', 'Nongstoin'],
  //     'Mizoram': ['Aizawl', 'Lunglei', 'Champhai', 'Serchhip', 'Kolasib', 'Saiha', 'Lawngtlai', 'Mamit', 'Hnahthial', 'Saitual', 'Khawzawl', 'Biate', 'Darlawn', 'Thenzawl', 'North Vanlaiphai'],
  //     'Nagaland': ['Kohima', 'Dimapur', 'Mokokchung', 'Tuensang', 'Wokha', 'Zunheboto', 'Phek', 'Mon', 'Kiphire', 'Longleng', 'Peren', 'Chumukedima', 'Pfutsero', 'Tuli', 'Mangkolemba'],
  //     'Odisha': ['Bhubaneswar', 'Cuttack', 'Rourkela', 'Berhampur', 'Sambalpur', 'Puri', 'Balasore', 'Bhadrak', 'Baripada', 'Jharsuguda', 'Jeypore', 'Bargarh', 'Balangir', 'Rayagada', 'Bhawanipatna', 'Dhenkanal', 'Barbil', 'Kendrapara', 'Sunabeda', 'Paradip', 'Angul', 'Jatani', 'Talcher', 'Titlagarh', 'Phulbani'],
  //     'Punjab': ['Ludhiana', 'Amritsar', 'Jalandhar', 'Patiala', 'Bathinda', 'Mohali', 'Hoshiarpur', 'Batala', 'Pathankot', 'Moga', 'Abohar', 'Malerkotla', 'Khanna', 'Phagwara', 'Muktsar', 'Barnala', 'Firozpur', 'Kapurthala', 'Zirakpur', 'Kot Kapura', 'Faridkot', 'Sunam', 'Jagraon', 'Morinda', 'Gurdaspur'],
  //     'Rajasthan': ['Jaipur', 'Jodhpur', 'Udaipur', 'Kota', 'Ajmer', 'Bikaner', 'Alwar', 'Bharatpur', 'Bhilwara', 'Sikar', 'Pali', 'Sri Ganganagar', 'Tonk', 'Kishangarh', 'Beawar', 'Hanumangarh', 'Chittorgarh', 'Churu', 'Jhunjhunu', 'Barmer', 'Bundi', 'Nagaur', 'Sawai Madhopur', 'Makrana', 'Sujangarh', 'Lachhmangarh', 'Rajsamand', 'Mount Abu', 'Pushkar', 'Nathdwara'],
  //     'Sikkim': ['Gangtok', 'Namchi', 'Gyalshing', 'Mangan', 'Rangpo', 'Singtam', 'Jorethang', 'Nayabazar', 'Melli', 'Ravangla', 'Pelling', 'Rongli', 'Yuksom', 'Lachung', 'Lachen'],
  //     'Tamil Nadu': ['Chennai', 'Coimbatore', 'Madurai', 'Tiruchirappalli', 'Salem', 'Tirunelveli', 'Vellore', 'Erode', 'Thoothukudi', 'Thanjavur', 'Dindigul', 'Ranipet', 'Sivakasi', 'Karur', 'Udhagamandalam', 'Hosur', 'Nagercoil', 'Kanchipuram', 'Kumbakonam', 'Tiruppur', 'Avadi', 'Tambaram', 'Cuddalore', 'Pollachi', 'Rajapalayam', 'Gudiyatham', 'Vaniyambadi', 'Ambur', 'Nagapattinam', 'Arakkonam', 'Pudukkottai', 'Neyveli', 'Palani', 'Vriddhachalam', 'Kanyakumari'],
  //     'Telangana': ['Hyderabad', 'Warangal', 'Nizamabad', 'Khammam', 'Karimnagar', 'Ramagundam', 'Mahbubnagar', 'Nalgonda', 'Adilabad', 'Suryapet', 'Siddipet', 'Miryalaguda', 'Jagtial', 'Mancherial', 'Nirmal', 'Kothagudem', 'Bodhan', 'Palwancha', 'Mandamarri', 'Koratla', 'Sircilla', 'Tandur', 'Sangareddy', 'Vikarabad', 'Wanaparthy', 'Bhongir', 'Gadwal', 'Kamareddy', 'Bellampalle', 'Nagarkurnool'],
  //     'Tripura': ['Agartala', 'Udaipur', 'Dharmanagar', 'Kailashahar', 'Ambassa', 'Belonia', 'Khowai', 'Teliamura', 'Sabroom', 'Sonamura', 'Kumarghat', 'Bishramganj', 'Ranirbazar', 'Kamalpur', 'Amarpur'],
  //     'Uttar Pradesh': ['Lucknow', 'Kanpur', 'Varanasi', 'Agra', 'Noida', 'Meerut', 'Allahabad', 'Ghaziabad', 'Bareilly', 'Aligarh', 'Moradabad', 'Saharanpur', 'Gorakhpur', 'Firozabad', 'Jhansi', 'Muzaffarnagar', 'Mathura', 'Rampur', 'Shahjahanpur', 'Farrukhabad', 'Ayodhya', 'Mau', 'Hapur', 'Etawah', 'Mirzapur', 'Bulandshahr', 'Sambhal', 'Amroha', 'Hardoi', 'Fatehpur', 'Raebareli', 'Orai', 'Sitapur', 'Bahraich', 'Modinagar', 'Unnao', 'Jaunpur', 'Lakhimpur', 'Hathras', 'Banda', 'Pilibhit', 'Barabanki', 'Khurja', 'Gonda', 'Mainpuri', 'Lalitpur', 'Etah', 'Deoria', 'Budaun', 'Bijnor'],
  //     'Uttarakhand': ['Dehradun', 'Haridwar', 'Roorkee', 'Haldwani', 'Rudrapur', 'Kashipur', 'Rishikesh', 'Ramnagar', 'Pithoragarh', 'Jaspur', 'Manglaur', 'Nainital', 'Pauri', 'Almora', 'Srinagar', 'Tehri', 'Kotdwara', 'Mussoorie', 'Champawat', 'Bageshwar', 'Rudraprayag', 'Uttarkashi', 'Vikasnagar', 'Clement Town', 'Khatima'],
  //     'West Bengal': ['Kolkata', 'Howrah', 'Durgapur', 'Asansol', 'Siliguri', 'Bardhaman', 'Malda', 'Baharampur', 'Habra', 'Kharagpur', 'Shantipur', 'Dankuni', 'Dhulian', 'Ranaghat', 'Haldia', 'Raiganj', 'Krishnanagar', 'Nabadwip', 'Medinipur', 'Jalpaiguri', 'Balurghat', 'Basirhat', 'Bankura', 'Chakdaha', 'Darjeeling', 'Alipurduar', 'Purulia', 'Jangipur', 'Bolpur', 'Bangaon'],
  //     'Delhi': ['New Delhi', 'Central Delhi', 'North Delhi', 'South Delhi', 'East Delhi', 'West Delhi', 'North East Delhi', 'North West Delhi', 'South East Delhi', 'South West Delhi', 'Shahdara']
  //   },
  //   'United Kingdom': {
  //     'England': ['London', 'Manchester', 'Birmingham', 'Liverpool', 'Leeds', 'Sheffield', 'Bristol', 'Newcastle'],
  //     'Scotland': ['Edinburgh', 'Glasgow', 'Aberdeen', 'Dundee', 'Inverness', 'Perth', 'Stirling'],
  //     'Wales': ['Cardiff', 'Swansea', 'Newport', 'Wrexham', 'Barry', 'Merthyr Tydfil'],
  //     'Northern Ireland': ['Belfast', 'Derry', 'Lisburn', 'Newry', 'Armagh']
  //   },
  //   'Canada': {
  //     'Alberta': ['Calgary', 'Edmonton', 'Red Deer', 'Lethbridge', 'St. Albert'],
  //     'British Columbia': ['Vancouver', 'Victoria', 'Surrey', 'Burnaby', 'Richmond', 'Kelowna'],
  //     'Manitoba': ['Winnipeg', 'Brandon', 'Steinbach', 'Thompson', 'Portage la Prairie'],
  //     'New Brunswick': ['Fredericton', 'Moncton', 'Saint John', 'Dieppe', 'Miramichi'],
  //     'Newfoundland and Labrador': ['St. John\'s', 'Mount Pearl', 'Corner Brook', 'Conception Bay South', 'Grand Falls-Windsor'],
  //     'Nova Scotia': ['Halifax', 'Dartmouth', 'Sydney', 'Truro', 'New Glasgow'],
  //     'Ontario': ['Toronto', 'Ottawa', 'Mississauga', 'Hamilton', 'London', 'Kitchener', 'Windsor'],
  //     'Prince Edward Island': ['Charlottetown', 'Summerside', 'Stratford', 'Cornwall', 'Montague'],
  //     'Quebec': ['Montreal', 'Quebec City', 'Laval', 'Gatineau', 'Longueuil', 'Sherbrooke'],
  //     'Saskatchewan': ['Saskatoon', 'Regina', 'Prince Albert', 'Moose Jaw', 'Swift Current']
  //   },
  //   'Australia': {
  //     'Australian Capital Territory': ['Canberra', 'Queanbeyan', 'Gungahlin', 'Tuggeranong', 'Belconnen'],
  //     'New South Wales': ['Sydney', 'Newcastle', 'Wollongong', 'Central Coast', 'Maitland', 'Wagga Wagga'],
  //     'Northern Territory': ['Darwin', 'Alice Springs', 'Palmerston', 'Katherine', 'Nhulunbuy'],
  //     'Queensland': ['Brisbane', 'Gold Coast', 'Cairns', 'Townsville', 'Toowoomba', 'Mackay'],
  //     'South Australia': ['Adelaide', 'Mount Gambier', 'Whyalla', 'Murray Bridge', 'Port Augusta'],
  //     'Tasmania': ['Hobart', 'Launceston', 'Devonport', 'Burnie', 'Kingston'],
  //     'Victoria': ['Melbourne', 'Geelong', 'Ballarat', 'Bendigo', 'Shepparton', 'Mildura'],
  //     'Western Australia': ['Perth', 'Mandurah', 'Bunbury', 'Kalgoorlie', 'Geraldton']
  //   },
  //   'Germany': {
  //     'Bavaria': ['Munich', 'Nuremberg', 'Augsburg', 'Regensburg', 'Ingolstadt'],
  //     'Berlin': ['Berlin'],
  //     'Baden-Württemberg': ['Stuttgart', 'Mannheim', 'Karlsruhe', 'Freiburg', 'Heidelberg'],
  //     'North Rhine-Westphalia': ['Cologne', 'Dortmund', 'Essen', 'Düsseldorf', 'Duisburg'],
  //     'Hamburg': ['Hamburg'],
  //     'Hesse': ['Frankfurt', 'Wiesbaden', 'Kassel', 'Darmstadt', 'Offenbach']
  //   },
  //   'France': {
  //     'Île-de-France': ['Paris', 'Boulogne-Billancourt', 'Argenteuil', 'Montreuil', 'Versailles'],
  //     'Provence-Alpes-Côte d\'Azur': ['Marseille', 'Nice', 'Toulon', 'Aix-en-Provence', 'Avignon'],
  //     'Auvergne-Rhône-Alpes': ['Lyon', 'Grenoble', 'Villeurbanne', 'Saint-Étienne', 'Clermont-Ferrand'],
  //     'Occitanie': ['Toulouse', 'Montpellier', 'Nîmes', 'Perpignan', 'Béziers'],
  //     'Nouvelle-Aquitaine': ['Bordeaux', 'Limoges', 'Poitiers', 'La Rochelle', 'Pau'],
  //     'Brittany': ['Rennes', 'Brest', 'Quimper', 'Lorient', 'Vannes']
  //   },
  //   'China': {
  //     'Beijing': ['Beijing'],
  //     'Shanghai': ['Shanghai'],
  //     'Guangdong': ['Guangzhou', 'Shenzhen', 'Dongguan', 'Foshan', 'Zhuhai'],
  //     'Zhejiang': ['Hangzhou', 'Ningbo', 'Wenzhou', 'Shaoxing', 'Taizhou'],
  //     'Jiangsu': ['Nanjing', 'Suzhou', 'Wuxi', 'Changzhou', 'Xuzhou'],
  //     'Sichuan': ['Chengdu', 'Mianyang', 'Deyang', 'Nanchong', 'Yibin']
  //   },
  //   'Japan': {
  //     'Tokyo': ['Tokyo', 'Setagaya', 'Nerima', 'Ota', 'Edogawa'],
  //     'Osaka': ['Osaka', 'Sakai', 'Higashiosaka', 'Hirakata', 'Toyonaka'],
  //     'Kyoto': ['Kyoto'],
  //     'Hokkaido': ['Sapporo', 'Asahikawa', 'Hakodate', 'Kushiro', 'Obihiro'],
  //     'Aichi': ['Nagoya', 'Toyota', 'Okazaki', 'Ichinomiya', 'Kasugai']
  //   },
  //   'Brazil': {
  //     'São Paulo': ['São Paulo', 'Campinas', 'São José dos Campos', 'Ribeirão Preto', 'Santos'],
  //     'Rio de Janeiro': ['Rio de Janeiro', 'Niterói', 'Duque de Caxias', 'Nova Iguaçu', 'Belford Roxo'],
  //     'Minas Gerais': ['Belo Horizonte', 'Uberlândia', 'Contagem', 'Juiz de Fora', 'Betim'],
  //     'Bahia': ['Salvador', 'Feira de Santana', 'Vitória da Conquista', 'Camaçari', 'Itabuna'],
  //     'Paraná': ['Curitiba', 'Londrina', 'Maringá', 'Ponta Grossa', 'Cascavel']
  //   },
  //   'Mexico': {
  //     'Mexico City': ['Mexico City'],
  //     'Jalisco': ['Guadalajara', 'Zapopan', 'Tlaquepaque', 'Tonalá', 'Puerto Vallarta'],
  //     'Nuevo León': ['Monterrey', 'Guadalupe', 'San Nicolás de los Garza', 'Apodaca', 'Santa Catarina'],
  //     'Puebla': ['Puebla', 'Tehuacán', 'San Martín Texmelucan', 'Atlixco', 'Cholula'],
  //     'Guanajuato': ['León', 'Irapuato', 'Celaya', 'Salamanca', 'Guanajuato']
  //   },
  //   'Italy': {
  //     'Lazio': ['Rome', 'Latina', 'Guidonia Montecelio', 'Fiumicino', 'Aprilia'],
  //     'Lombardy': ['Milan', 'Brescia', 'Monza', 'Bergamo', 'Como'],
  //     'Campania': ['Naples', 'Salerno', 'Giugliano in Campania', 'Torre del Greco', 'Pozzuoli'],
  //     'Sicily': ['Palermo', 'Catania', 'Messina', 'Syracuse', 'Marsala'],
  //     'Veneto': ['Venice', 'Verona', 'Padua', 'Vicenza', 'Treviso']
  //   },
  //   'Spain': {
  //     'Madrid': ['Madrid', 'Móstoles', 'Alcalá de Henares', 'Fuenlabrada', 'Leganés'],
  //     'Catalonia': ['Barcelona', 'Hospitalet de Llobregat', 'Badalona', 'Terrassa', 'Sabadell'],
  //     'Andalusia': ['Seville', 'Málaga', 'Córdoba', 'Granada', 'Jerez de la Frontera'],
  //     'Valencia': ['Valencia', 'Alicante', 'Elche', 'Castellón de la Plana', 'Torrevieja'],
  //     'Basque Country': ['Bilbao', 'Vitoria-Gasteiz', 'San Sebastián', 'Barakaldo', 'Getxo']
  //   },
  //   'South Africa': {
  //     'Gauteng': ['Johannesburg', 'Pretoria', 'Soweto', 'Benoni', 'Boksburg'],
  //     'Western Cape': ['Cape Town', 'Stellenbosch', 'Paarl', 'George', 'Worcester'],
  //     'KwaZulu-Natal': ['Durban', 'Pietermaritzburg', 'Newcastle', 'Richards Bay', 'Ladysmith'],
  //     'Eastern Cape': ['Port Elizabeth', 'East London', 'Mthatha', 'Grahamstown', 'King William\'s Town']
  //   },
  //   'Argentina': {
  //     'Buenos Aires': ['Buenos Aires', 'La Plata', 'Mar del Plata', 'Bahía Blanca', 'Quilmes'],
  //     'Córdoba': ['Córdoba', 'Villa María', 'Río Cuarto', 'San Francisco', 'Villa Carlos Paz'],
  //     'Santa Fe': ['Rosario', 'Santa Fe', 'Rafaela', 'Reconquista', 'Venado Tuerto'],
  //     'Mendoza': ['Mendoza', 'Godoy Cruz', 'Las Heras', 'Maipú', 'San Rafael']
  //   },
  //   'Russia': {
  //     'Moscow': ['Moscow'],
  //     'Saint Petersburg': ['Saint Petersburg'],
  //     'Moscow Oblast': ['Balashikha', 'Khimki', 'Podolsk', 'Korolev', 'Mytishchi'],
  //     'Krasnodar Krai': ['Krasnodar', 'Sochi', 'Novorossiysk', 'Armavir', 'Yeysk'],
  //     'Sverdlovsk Oblast': ['Yekaterinburg', 'Nizhny Tagil', 'Kamensk-Uralsky', 'Pervouralsk', 'Serov']
  //   },
  //   'Netherlands': {
  //     'North Holland': ['Amsterdam', 'Haarlem', 'Zaanstad', 'Haarlemmermeer', 'Alkmaar'],
  //     'South Holland': ['Rotterdam', 'The Hague', 'Leiden', 'Dordrecht', 'Zoetermeer'],
  //     'North Brabant': ['Eindhoven', 'Tilburg', 'Breda', 's-Hertogenbosch', 'Helmond'],
  //     'Utrecht': ['Utrecht', 'Amersfoort', 'Veenendaal', 'Nieuwegein', 'Zeist']
  //   },
  //   'Switzerland': {
  //     'Zurich': ['Zurich', 'Winterthur', 'Uster', 'Dübendorf', 'Dietikon'],
  //     'Bern': ['Bern', 'Biel/Bienne', 'Thun', 'Köniz', 'Burgdorf'],
  //     'Geneva': ['Geneva', 'Vernier', 'Lancy', 'Meyrin', 'Carouge'],
  //     'Vaud': ['Lausanne', 'Yverdon-les-Bains', 'Montreux', 'Renens', 'Nyon']
  //   },
  //   'Sweden': {
  //     'Stockholm': ['Stockholm', 'Huddinge', 'Sollentuna', 'Haninge', 'Botkyrka'],
  //     'Västra Götaland': ['Gothenburg', 'Borås', 'Mölndal', 'Trollhättan', 'Uddevalla'],
  //     'Skåne': ['Malmö', 'Helsingborg', 'Lund', 'Kristianstad', 'Landskrona'],
  //     'Uppsala': ['Uppsala', 'Enköping', 'Håbo', 'Älvkarleby', 'Östhammar']
  //   },
  //   'Norway': {
  //     'Oslo': ['Oslo'],
  //     'Viken': ['Drammen', 'Fredrikstad', 'Sarpsborg', 'Lillestrøm', 'Moss'],
  //     'Vestland': ['Bergen', 'Stavanger', 'Sandnes', 'Haugesund', 'Ålesund'],
  //     'Trøndelag': ['Trondheim', 'Steinkjer', 'Namsos', 'Levanger', 'Verdal']
  //   },
  //   'Denmark': {
  //     'Capital Region': ['Copenhagen', 'Frederiksberg', 'Gentofte', 'Gladsaxe', 'Herlev'],
  //     'Central Denmark': ['Aarhus', 'Randers', 'Horsens', 'Viborg', 'Silkeborg'],
  //     'Southern Denmark': ['Odense', 'Esbjerg', 'Vejle', 'Kolding', 'Sønderborg'],
  //     'Zealand': ['Roskilde', 'Næstved', 'Køge', 'Slagelse', 'Holbæk']
  //   },
  //   'Poland': {
  //     'Masovian': ['Warsaw', 'Radom', 'Płock', 'Siedlce', 'Ostrołęka'],
  //     'Lesser Poland': ['Kraków', 'Tarnów', 'Nowy Sącz', 'Oświęcim', 'Chrzanów'],
  //     'Greater Poland': ['Poznań', 'Kalisz', 'Konin', 'Piła', 'Ostrów Wielkopolski'],
  //     'Silesian': ['Katowice', 'Częstochowa', 'Sosnowiec', 'Gliwice', 'Zabrze']
  //   },
  //   'Turkey': {
  //     'Istanbul': ['Istanbul'],
  //     'Ankara': ['Ankara'],
  //     'Izmir': ['Izmir', 'Karşıyaka', 'Bornova', 'Konak', 'Buca'],
  //     'Antalya': ['Antalya', 'Alanya', 'Manavgat', 'Kemer', 'Side'],
  //     'Bursa': ['Bursa', 'Osmangazi', 'Nilüfer', 'Yıldırım', 'Gemlik']
  //   },
  //   'Saudi Arabia': {
  //     'Riyadh': ['Riyadh', 'Al Kharj', 'Ad Diriyah', 'Dawadmi', 'Al Majma\'ah'],
  //     'Makkah': ['Mecca', 'Jeddah', 'Taif', 'Rabigh', 'Al Qunfudhah'],
  //     'Eastern Province': ['Dammam', 'Dhahran', 'Khobar', 'Jubail', 'Al Ahsa'],
  //     'Madinah': ['Medina', 'Yanbu', 'Al Ula', 'Khaybar', 'Badr']
  //   },
  //   'United Arab Emirates': {
  //     'Dubai': ['Dubai'],
  //     'Abu Dhabi': ['Abu Dhabi', 'Al Ain', 'Zayed City', 'Ruwais', 'Liwa Oasis'],
  //     'Sharjah': ['Sharjah', 'Kalba', 'Khor Fakkan', 'Dibba Al-Hisn', 'Dhaid'],
  //     'Ajman': ['Ajman'],
  //     'Ras Al Khaimah': ['Ras Al Khaimah']
  //   },
  //   'New Zealand': {
  //     'Auckland': ['Auckland', 'Manukau', 'North Shore', 'Waitakere', 'Papakura'],
  //     'Wellington': ['Wellington', 'Lower Hutt', 'Upper Hutt', 'Porirua', 'Kapiti Coast'],
  //     'Canterbury': ['Christchurch', 'Timaru', 'Ashburton', 'Rangiora', 'Kaiapoi'],
  //     'Waikato': ['Hamilton', 'Taupo', 'Tokoroa', 'Cambridge', 'Te Awamutu']
  //   },
  //   'Singapore': {
  //     'Central Region': ['Singapore City', 'Bukit Timah', 'Marina Bay', 'Orchard', 'Novena'],
  //     'East Region': ['Bedok', 'Tampines', 'Pasir Ris', 'Changi', 'Simei'],
  //     'North Region': ['Yishun', 'Sembawang', 'Woodlands', 'Admiralty', 'Marsiling'],
  //     'West Region': ['Jurong', 'Clementi', 'Boon Lay', 'Choa Chu Kang', 'Bukit Batok']
  //   },
  //   'Malaysia': {
  //     'Kuala Lumpur': ['Kuala Lumpur'],
  //     'Selangor': ['Shah Alam', 'Petaling Jaya', 'Subang Jaya', 'Klang', 'Ampang'],
  //     'Penang': ['George Town', 'Butterworth', 'Bukit Mertajam', 'Balik Pulau', 'Kepala Batas'],
  //     'Johor': ['Johor Bahru', 'Muar', 'Batu Pahat', 'Kluang', 'Segamat'],
  //     'Sabah': ['Kota Kinabalu', 'Sandakan', 'Tawau', 'Lahad Datu', 'Keningau']
  //   },
  //   'Indonesia': {
  //     'Jakarta': ['Jakarta'],
  //     'West Java': ['Bandung', 'Bekasi', 'Depok', 'Bogor', 'Cirebon'],
  //     'East Java': ['Surabaya', 'Malang', 'Kediri', 'Probolinggo', 'Pasuruan'],
  //     'Central Java': ['Semarang', 'Surakarta', 'Salatiga', 'Pekalongan', 'Tegal'],
  //     'Bali': ['Denpasar', 'Ubud', 'Sanur', 'Kuta', 'Seminyak']
  //   },
  //   'Thailand': {
  //     'Bangkok': ['Bangkok'],
  //     'Chiang Mai': ['Chiang Mai', 'San Kamphaeng', 'Hang Dong', 'Mae Rim', 'Doi Saket'],
  //     'Phuket': ['Phuket', 'Patong', 'Kata', 'Karon', 'Kamala'],
  //     'Chonburi': ['Pattaya', 'Chonburi', 'Si Racha', 'Bang Lamung', 'Sattahip']
  //   },
  //   'Philippines': {
  //     'Metro Manila': ['Manila', 'Quezon City', 'Makati', 'Pasig', 'Taguig'],
  //     'Cebu': ['Cebu City', 'Mandaue', 'Lapu-Lapu', 'Talisay', 'Toledo'],
  //     'Davao': ['Davao City', 'Tagum', 'Panabo', 'Digos', 'Mati'],
  //     'Calabarzon': ['Antipolo', 'Calamba', 'Bacoor', 'San Pedro', 'Biñan']
  //   },
  //   'Vietnam': {
  //     'Hanoi': ['Hanoi'],
  //     'Ho Chi Minh City': ['Ho Chi Minh City'],
  //     'Da Nang': ['Da Nang'],
  //     'Hai Phong': ['Hai Phong'],
  //     'Can Tho': ['Can Tho']
  //   },
  //   'South Korea': {
  //     'Seoul': ['Seoul', 'Gangnam', 'Gangbuk', 'Mapo', 'Songpa'],
  //     'Busan': ['Busan'],
  //     'Incheon': ['Incheon'],
  //     'Daegu': ['Daegu'],
  //     'Daejeon': ['Daejeon']
  //   },
  //   'Egypt': {
  //     'Cairo': ['Cairo', 'Giza', 'Helwan', 'Shubra El Kheima', '6th of October City'],
  //     'Alexandria': ['Alexandria', 'Borg El Arab', 'Abu Qir', 'El Montaza', 'Miami'],
  //     'Giza': ['Giza', 'Dokki', 'Mohandessin', 'Agouza', 'Imbaba'],
  //     'Qalyubia': ['Benha', 'Qalyub', 'Shubra al Khaymah', 'Khanka', 'Kafr Shukr']
  //   },
  //   'Nigeria': {
  //     'Lagos': ['Lagos', 'Ikeja', 'Lekki', 'Victoria Island', 'Ikoyi'],
  //     'Kano': ['Kano'],
  //     'Abuja': ['Abuja'],
  //     'Ibadan': ['Ibadan'],
  //     'Port Harcourt': ['Port Harcourt']
  //   },
  //   'Kenya': {
  //     'Nairobi': ['Nairobi', 'Westlands', 'Kilimani', 'Kasarani', 'Embakasi'],
  //     'Mombasa': ['Mombasa'],
  //     'Kisumu': ['Kisumu'],
  //     'Nakuru': ['Nakuru'],
  //     'Eldoret': ['Eldoret']
  //   }
  // }

  // Duplicate synchronous handlers removed — the async handlers that call fetchCountries/fetchStates/fetchCities above are used instead.

  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }))
  }

  const handleAmenityToggle = (amenity) => {
    setFormData(prev => ({
      ...prev,
      amenities: prev.amenities.includes(amenity)
        ? prev.amenities.filter(a => a !== amenity)
        : [...prev.amenities, amenity]
    }))
  }

  const handleImageUpload = (files) => {
    const newFiles = Array.from(files)
    const newPreviews = newFiles.map(file => URL.createObjectURL(file))
    
    setFormData(prev => ({
      ...prev,
      images: [...prev.images, ...newFiles]
    }))
    
    setPreviewImages(prev => [...prev, ...newPreviews])
  }

  const handleFileInputChange = (e) => {
    if (e.target.files) {
      handleImageUpload(e.target.files)
    }
  }

  const handleDrag = (e) => {
    e.preventDefault()
    e.stopPropagation()
    if (e.type === 'dragenter' || e.type === 'dragover') {
      setDragActive(true)
    } else if (e.type === 'dragleave') {
      setDragActive(false)
    }
  }

  const handleDrop = (e) => {
    e.preventDefault()
    e.stopPropagation()
    setDragActive(false)
    
    if (e.dataTransfer.files && e.dataTransfer.files[0]) {
      handleImageUpload(e.dataTransfer.files)
    }
  }

  const removeImage = (index) => {
    setFormData(prev => ({
      ...prev,
      images: prev.images.filter((_, i) => i !== index)
    }))
    setPreviewImages(prev => prev.filter((_, i) => i !== index))
  }

  const nextStep = () => {
    if (currentStep < 4) {
      setCurrentStep(prev => prev + 1)
    }
  }

  const prevStep = () => {
    if (currentStep > 1) {
      setCurrentStep(prev => prev - 1)
    }
  }

  const handleSubmit = async (e) => {
    e.preventDefault()
    
    // Check authentication
    const token = localStorage.getItem('token')
    if (!token) {
      setError('Please login to upload a property')
      setTimeout(() => navigate('/signin'), 2000)
      return
    }

    setLoading(true)
    setError(null)

    try {
      // Step 1: Upload images to Cloudinary
      let uploadedImages = []
      
      if (formData.images.length > 0) {
        const formDataImages = new FormData()
        formData.images.forEach((file) => {
          formDataImages.append('images', file)
        })

        const imageUploadResponse = await fetch(`${API_URL}/api/auth/upload-images`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formDataImages
        })

        const imageData = await imageUploadResponse.json()

        if (!imageUploadResponse.ok) {
          if (imageUploadResponse.status === 401) {
            setError('Your session has expired. Please login again.')
            localStorage.removeItem('token')
            localStorage.removeItem('user')
            auth.logout()
            setTimeout(() => navigate('/signin'), 2000)
            return
          }
          throw new Error(imageData.message || 'Failed to upload images')
        }

        uploadedImages = imageData.images
      }

      // Step 2: Create property with Cloudinary URLs
      const propertyData = {
        title: formData.title,
        description: formData.description,
        price: parseFloat(formData.price),
        address: {
          street: formData.address,
          city: formData.city,
          state: formData.state,
          zipCode: formData.zipCode,
          country: formData.country
        },
        images: uploadedImages,
        instagram: formData.instagram || null,
        youtube: formData.youtube || null
      }

      const response = await fetch(`${API_URL}/api/auth/properties`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(propertyData)
      })

      const data = await response.json()

      if (!response.ok) {
        if (response.status === 401) {
          setError('Your session has expired. Please login again.')
          localStorage.removeItem('token')
          localStorage.removeItem('user')
          auth.logout()
          setTimeout(() => navigate('/signin'), 2000)
          return
        }
        throw new Error(data.message || 'Failed to create property')
      }

      setSuccess(true)
      console.log('Property created:', data.property)
      
      // Redirect to property listing after 2 seconds
      setTimeout(() => {
        navigate('/properties')
      }, 2000)

    } catch (err) {
      console.error('Error creating property:', err)
      setError(err.message || 'Failed to upload property. Please try again.')
    } finally {
      setLoading(false)
    }
  }

  const isStepValid = () => {
    switch (currentStep) {
      case 1:
        return formData.title && formData.description && formData.type
      case 2:
        return formData.price && formData.address && formData.city
      case 3:
        return formData.beds && formData.baths && formData.area
      case 4:
        return formData.images.length > 0
      default:
        return false
    }
  }

  return (
    <div className="upload-property-page">
      {/* Header */}
      <div className="upload-header">
        <div className="upload-header-content">
          <h1 className="upload-title">List Your Property</h1>
          <p className="upload-subtitle">Share your property with thousands of potential buyers</p>
        </div>
      </div>

      {/* Success Message */}
      {success && (
        <div className="notification success">
          <svg className="notification-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <p>Property uploaded successfully! Redirecting...</p>
        </div>
      )}

      {/* Error Message */}
      {error && (
        <div className="notification error">
          <svg className="notification-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <p>{error}</p>
        </div>
      )}

      {/* Progress Steps */}
      <div className="progress-container">
        <div className="progress-steps">
          {[1, 2, 3, 4].map((step) => (
            <div key={step} className="progress-step-wrapper">
              <div className={`progress-step ${currentStep >= step ? 'active' : ''} ${currentStep > step ? 'completed' : ''}`}>
                {currentStep > step ? (
                  <svg className="check-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                  </svg>
                ) : (
                  <span>{step}</span>
                )}
              </div>
              <p className="progress-label">
                {step === 1 && 'Basic Info'}
                {step === 2 && 'Location & Price'}
                {step === 3 && 'Details'}
                {step === 4 && 'Photos'}
              </p>
              {step < 4 && <div className={`progress-line ${currentStep > step ? 'completed' : ''}`} />}
            </div>
          ))}
        </div>
      </div>

      {/* Form */}
      <form onSubmit={handleSubmit} className="upload-form">
        <div className="form-container">
          {/* Step 1: Basic Info */}
          {currentStep === 1 && (
            <div className="form-step" key="step1">
              <h2 className="step-title">Basic Information</h2>
              <p className="step-description">Tell us about your property</p>

              <div className="form-grid">
                <div className="form-group full-width">
                  <label htmlFor="title" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    Property Title *
                  </label>
                  <input
                    type="text"
                    id="title"
                    name="title"
                    value={formData.title}
                    onChange={handleInputChange}
                    placeholder="e.g., Modern Family House in Downtown"
                    className="form-input"
                    required
                  />
                </div>

                <div className="form-group full-width">
                  <label htmlFor="type" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    Property Type *
                  </label>
                  <select
                    id="type"
                    name="type"
                    value={formData.type}
                    onChange={handleInputChange}
                    className="form-select"
                    required
                  >
                    <option value="">Select property type</option>
                    {propertyTypes.map(type => (
                      <option key={type} value={type}>{type}</option>
                    ))}
                  </select>
                </div>

                <div className="form-group full-width">
                  <label htmlFor="description" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h7" />
                    </svg>
                    Description *
                  </label>
                  <textarea
                    id="description"
                    name="description"
                    value={formData.description}
                    onChange={handleInputChange}
                    placeholder="Describe your property, its features, and what makes it special..."
                    className="form-textarea"
                    rows={5}
                    required
                  />
                </div>

                <div className="form-group full-width">
                  <label className="checkbox-label">
                    <input
                      type="checkbox"
                      name="featured"
                      checked={formData.featured}
                      onChange={handleInputChange}
                      className="form-checkbox"
                    />
                    <span className="checkbox-text">Mark as Featured Property</span>
                  </label>
                </div>
              </div>
            </div>
          )}

          {/* Step 2: Location & Price */}
          {currentStep === 2 && (
            <div className="form-step" key="step2">
              <h2 className="step-title">Location & Pricing</h2>
              <p className="step-description">Where is your property located?</p>

              <div className="form-grid">
                <div className="form-group full-width">
                  <label htmlFor="price" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Price (USD) *
                  </label>
                  <input
                    type="number"
                    id="price"
                    name="price"
                    value={formData.price}
                    onChange={handleInputChange}
                    placeholder="e.g., 450000"
                    className="form-input"
                    required
                  />
                </div>

                <div className="form-group full-width">
                  <label htmlFor="address" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Street Address *
                  </label>
                  <input
                    type="text"
                    id="address"
                    name="address"
                    value={formData.address}
                    onChange={handleInputChange}
                    placeholder="e.g., 123 Main Street"
                    className="form-input"
                    required
                  />
                </div>

                <div className="form-group">
                  <label htmlFor="country" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Country *
                  </label>
                  <div className="searchable-dropdown">
                    <input
                      type="text"
                      className="form-input searchable-input"
                      placeholder="Search or select country..."
                      value={countrySearch || formData.country}
                      onChange={(e) => {
                        setCountrySearch(e.target.value)
                        setShowCountryDropdown(true)
                      }}
                      onFocus={() => setShowCountryDropdown(true)}
                      required={!formData.country}
                    />
                    {showCountryDropdown && (
                      <div className="dropdown-list">
                        <div className="dropdown-header">
                          <span className="dropdown-title">Select Country</span>
                          <button
                            type="button"
                            className="dropdown-close"
                            onClick={() => {
                              setShowCountryDropdown(false)
                              setCountrySearch('')
                            }}
                          >
                            ×
                          </button>
                        </div>
                        {loadingLocations ? (
                          <div className="dropdown-item" style={{ textAlign: 'center', color: '#667eea' }}>
                            Loading countries...
                          </div>
                        ) : (
                          countries
                            .filter(country => 
                              country.name.toLowerCase().includes(countrySearch.toLowerCase())
                            )
                            .map(country => (
                              <div
                                key={country.iso2}
                                className={`dropdown-item ${formData.country === country.name ? 'selected' : ''}`}
                                onClick={() => {
                                  handleCountryChange({ target: { value: country.name } })
                                  setCountrySearch('')
                                  setShowCountryDropdown(false)
                                }}
                              >
                                {country.name}
                              </div>
                            ))
                        )}
                      </div>
                    )}
                  </div>
                </div>

                <div className="form-group">
                  <label htmlFor="state" className="form-label">State *</label>
                  <div className="searchable-dropdown">
                    <input
                      type="text"
                      className="form-input searchable-input"
                      placeholder={!formData.country ? "Select country first..." : "Search or select state..."}
                      value={stateSearch || formData.state}
                      onChange={(e) => {
                        setStateSearch(e.target.value)
                        setShowStateDropdown(true)
                      }}
                      onFocus={() => formData.country && setShowStateDropdown(true)}
                      disabled={!formData.country}
                      required={!formData.state}
                    />
                    {showStateDropdown && formData.country && (
                      <div className="dropdown-list">
                        <div className="dropdown-header">
                          <span className="dropdown-title">Select State/Province</span>
                          <button
                            type="button"
                            className="dropdown-close"
                            onClick={() => {
                              setShowStateDropdown(false)
                              setStateSearch('')
                            }}
                          >
                            ×
                          </button>
                        </div>
                        {loadingLocations ? (
                          <div className="dropdown-item" style={{ textAlign: 'center', color: '#667eea' }}>
                            Loading states...
                          </div>
                        ) : (
                          availableStates
                            .filter(state => 
                              state.name.toLowerCase().includes(stateSearch.toLowerCase())
                            )
                            .map(state => (
                              <div
                                key={state.iso2}
                                className={`dropdown-item ${formData.state === state.name ? 'selected' : ''}`}
                                onClick={() => {
                                  handleStateChange({ target: { value: state.name } })
                                  setStateSearch('')
                                  setShowStateDropdown(false)
                                }}
                              >
                                {state.name}
                              </div>
                            ))
                        )}
                      </div>
                    )}
                  </div>
                </div>

                <div className="form-group">
                  <label htmlFor="city" className="form-label">City *</label>
                  <div className="searchable-dropdown">
                    <input
                      type="text"
                      className="form-input searchable-input"
                      placeholder={!formData.state ? "Select state first..." : "Search or select city..."}
                      value={citySearch || formData.city}
                      onChange={(e) => {
                        setCitySearch(e.target.value)
                        setShowCityDropdown(true)
                      }}
                      onFocus={() => formData.state && setShowCityDropdown(true)}
                      disabled={!formData.state}
                      required={!formData.city}
                    />
                    {showCityDropdown && formData.state && (
                      <div className="dropdown-list">
                        <div className="dropdown-header">
                          <span className="dropdown-title">Select City</span>
                          <button
                            type="button"
                            className="dropdown-close"
                            onClick={() => {
                              setShowCityDropdown(false)
                              setCitySearch('')
                            }}
                          >
                            ×
                          </button>
                        </div>
                        {loadingLocations ? (
                          <div className="dropdown-item" style={{ textAlign: 'center', color: '#667eea' }}>
                            Loading cities...
                          </div>
                        ) : (
                          availableCities
                            .filter(city => 
                              city.name.toLowerCase().includes(citySearch.toLowerCase())
                            )
                            .map(city => (
                              <div
                                key={city.id || city.name}
                                className={`dropdown-item ${formData.city === city.name ? 'selected' : ''}`}
                                onClick={() => {
                                  handleCityChange({ target: { value: city.name } })
                                  setCitySearch('')
                                  setShowCityDropdown(false)
                                }}
                              >
                                {city.name}
                              </div>
                            ))
                        )}
                      </div>
                    )}
                  </div>
                </div>

                <div className="form-group">
                  <label htmlFor="zipCode" className="form-label">ZIP Code</label>
                  <input
                    type="text"
                    id="zipCode"
                    name="zipCode"
                    value={formData.zipCode}
                    onChange={handleInputChange}
                    placeholder="e.g., 10001"
                    className="form-input"
                  />
                </div>
              </div>
            </div>
          )}

          {/* Step 3: Property Details */}
          {currentStep === 3 && (
            <div className="form-step" key="step3">
              <h2 className="step-title">Property Details</h2>
              <p className="step-description">Provide specific details about your property</p>

              <div className="form-grid">
                <div className="form-group">
                  <label htmlFor="beds" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                    Bedrooms *
                  </label>
                  <input
                    type="number"
                    id="beds"
                    name="beds"
                    value={formData.beds}
                    onChange={handleInputChange}
                    placeholder="e.g., 3"
                    className="form-input"
                    min="0"
                    required
                  />
                </div>

                <div className="form-group">
                  <label htmlFor="baths" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M10.5 3L12 2l1.5 1H21v6H3V3h7.5z" />
                    </svg>
                    Bathrooms *
                  </label>
                  <input
                    type="number"
                    id="baths"
                    name="baths"
                    value={formData.baths}
                    onChange={handleInputChange}
                    placeholder="e.g., 2"
                    className="form-input"
                    min="0"
                    step="0.5"
                    required
                  />
                </div>

                <div className="form-group">
                  <label htmlFor="area" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                    </svg>
                    Area (sqft) *
                  </label>
                  <input
                    type="number"
                    id="area"
                    name="area"
                    value={formData.area}
                    onChange={handleInputChange}
                    placeholder="e.g., 2500"
                    className="form-input"
                    min="0"
                    required
                  />
                </div>

                <div className="form-group">
                  <label htmlFor="yearBuilt" className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Year Built
                  </label>
                  <input
                    type="number"
                    id="yearBuilt"
                    name="yearBuilt"
                    value={formData.yearBuilt}
                    onChange={handleInputChange}
                    placeholder="e.g., 2020"
                    className="form-input"
                    min="1800"
                    max={new Date().getFullYear()}
                  />
                </div>

                <div className="form-group full-width">
                  <label className="form-label">
                    <svg className="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                    </svg>
                    Amenities
                  </label>
                  <div className="amenities-selector">
                    {amenitiesList.map(amenity => (
                      <button
                        key={amenity}
                        type="button"
                        onClick={() => handleAmenityToggle(amenity)}
                        className={`amenity-chip ${formData.amenities.includes(amenity) ? 'selected' : ''}`}
                      >
                        {formData.amenities.includes(amenity) && (
                          <svg className="chip-check" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                          </svg>
                        )}
                        {amenity}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Social Media Links */}
                <div className="form-group full-width social-media-section">
                  <h3 className="section-subtitle">Social Media Links (Optional)</h3>
                  <p className="section-description">Add your social media to showcase your property</p>
                </div>

                <div className="form-group">
                  <label htmlFor="instagram" className="form-label">
                    <svg className="label-icon" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>
                    Instagram Username
                  </label>
                  <input
                    type="text"
                    id="instagram"
                    name="instagram"
                    value={formData.instagram}
                    onChange={handleInputChange}
                    placeholder="e.g., mypropertypage"
                    className="form-input"
                  />
                  <small className="input-hint">Enter username only (without @)</small>
                </div>

                <div className="form-group">
                  <label htmlFor="youtube" className="form-label">
                    <svg className="label-icon" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                    YouTube Channel/Video ID
                  </label>
                  <input
                    type="text"
                    id="youtube"
                    name="youtube"
                    value={formData.youtube}
                    onChange={handleInputChange}
                    placeholder="e.g., channel_name or video_id"
                    className="form-input"
                  />
                  <small className="input-hint">Enter channel name or video ID</small>
                </div>
              </div>
            </div>
          )}

          {/* Step 4: Photos */}
          {currentStep === 4 && (
            <div className="form-step" key="step4">
              <h2 className="step-title">Property Photos</h2>
              <p className="step-description">Upload high-quality images of your property</p>

              <div className="upload-section">
                {/* Drop Zone */}
                <div
                  className={`drop-zone ${dragActive ? 'active' : ''}`}
                  onDragEnter={handleDrag}
                  onDragLeave={handleDrag}
                  onDragOver={handleDrag}
                  onDrop={handleDrop}
                >
                  <input
                    type="file"
                    id="fileInput"
                    multiple
                    accept="image/*"
                    onChange={handleFileInputChange}
                    className="file-input"
                  />
                  <label htmlFor="fileInput" className="drop-zone-label">
                    <svg className="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <h3>Drag & Drop your images here</h3>
                    <p>or click to browse</p>
                    <span className="file-types">PNG, JPG, GIF up to 10MB</span>
                  </label>
                </div>

                {/* Image Previews */}
                {previewImages.length > 0 && (
                  <div className="image-previews">
                    <h3 className="previews-title">Uploaded Images ({previewImages.length})</h3>
                    <div className="previews-grid">
                      {previewImages.map((preview, index) => (
                        <div key={index} className="preview-item">
                          <img src={preview} alt={`Preview ${index + 1}`} className="preview-image" />
                          <button
                            type="button"
                            onClick={() => removeImage(index)}
                            className="remove-image"
                          >
                            <svg fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                            </svg>
                          </button>
                          {index === 0 && (
                            <div className="primary-badge">Primary</div>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Navigation Buttons */}
          <div className="form-navigation">
            {currentStep > 1 && (
              <button
                type="button"
                onClick={prevStep}
                className="nav-button secondary"
              >
                <svg className="button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
                Previous
              </button>
            )}

            {currentStep < 4 ? (
              <button
                type="button"
                onClick={nextStep}
                disabled={!isStepValid()}
                className="nav-button primary"
              >
                Next
                <svg className="button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                </svg>
              </button>
            ) : (
              <button
                type="submit"
                disabled={!isStepValid() || loading}
                className="nav-button submit"
              >
                {loading ? (
                  <>
                    <div className="button-spinner" />
                    Uploading...
                  </>
                ) : (
                  <>
                    <svg className="button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                    </svg>
                    Submit Property
                  </>
                )}
              </button>
            )}
          </div>
        </div>
      </form>
    </div>
  )
}
