// Prisma schema for Real-Estate project
// https://www.prisma.io/docs/concepts/components/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String  @id @default(cuid())
  username  String? @unique @db.VarChar(50)
  email     String  @unique @db.VarChar(255)
  password  String? @db.VarChar(255)
  googleId  String? @unique @db.VarChar(255)
  firstName String? @db.VarChar(100)
  lastName  String? @db.VarChar(100)
  provider  String  @default("local") @db.VarChar(20)

  properties Property[] @relation("UserProperties")
  inquiries  Inquiry[]
  favorites  Favorite[]
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  @@map("users")
}

// Properties table
model Property {
  id          String            @id @default(cuid())
  title       String?           @db.VarChar(255)
  description String?           @db.Text
  price       Decimal?          @db.Decimal(12, 2)
  ownerId     String?
  owner       User?             @relation(fields: [ownerId], references: [id], name: "UserProperties")
  address     Address?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  images      PropertyImage[]
  features    PropertyFeature[]
  inquiries   Inquiry[]
  favorites   Favorite[]

  @@map("properties")
}

model Address {
  id         String   @id @default(cuid())
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String   @unique
  street     String?  @db.VarChar(255)
  city       String?  @db.VarChar(100)
  state      String?  @db.VarChar(100)
  zipCode    String?  @db.VarChar(20)
  country    String?  @db.VarChar(100)

  @@map("addresses")
}

model PropertyImage {
  id         String   @id @default(cuid())
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String
  url        String   @db.VarChar(1024)
  order      Int      @default(0)
  isPrimary  Boolean  @default(false)
  createdAt  DateTime @default(now())

  @@map("property_images")
}

model Feature {
  id         String            @id @default(cuid())
  name       String            @unique @db.VarChar(100)
  properties PropertyFeature[]

  @@map("features")
}

model PropertyFeature {
  id         String   @id @default(cuid())
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String
  feature    Feature  @relation(fields: [featureId], references: [id])
  featureId  String

  @@unique([propertyId, featureId])
  @@map("property_features")
}

model Inquiry {
  id         String   @id @default(cuid())
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String
  user       User?    @relation(fields: [userId], references: [id])
  userId     String?
  name       String   @db.VarChar(200)
  email      String   @db.VarChar(255)
  message    String   @db.Text
  createdAt  DateTime @default(now())

  @@map("inquiries")
}

model Favorite {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId String
  createdAt  DateTime @default(now())

  @@unique([userId, propertyId])
  @@map("favorites")
}
