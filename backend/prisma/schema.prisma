generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String         @id @default(cuid())
  username            String?        @unique @db.VarChar(50)
  email               String         @unique @db.VarChar(255)
  password            String?        @db.VarChar(255)
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  firstName           String?        @db.VarChar(100)
  googleId            String?        @unique @db.VarChar(255)
  lastName            String?        @db.VarChar(100)
  provider            String         @default("local") @db.VarChar(20)
  avatar              String?        @db.VarChar(1024)
  bio                 String?        @db.Text
  location            String?        @db.VarChar(255)
  phone               String?        @db.VarChar(20)
  buyerConversations  Conversation[] @relation("BuyerConversations")
  sellerConversations Conversation[] @relation("SellerConversations")
  favorites           Favorite[]
  inquiries           Inquiry[]
  sentMessages        Message[]      @relation("SentMessages")
  properties          Property[]     @relation("UserProperties")

  @@map("users")
}

model Property {
  id                 String            @id @default(cuid())
  title              String?           @db.VarChar(255)
  description        String?           @db.Text
  price              Decimal?          @db.Decimal(12, 2)
  propertyType       String?           @db.VarChar(50)
  verificationStatus String            @default("pending") @db.VarChar(20)
  ownerId            String?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  instagram          String?           @db.VarChar(100)
  youtube            String?           @db.VarChar(100)
  address            Address?
  conversations      Conversation[]
  favorites          Favorite[]
  inquiries          Inquiry[]
  owner              User?             @relation("UserProperties", fields: [ownerId], references: [id])
  features           PropertyFeature[]
  images             PropertyImage[]

  @@index([ownerId])
  @@map("properties")
}

model Address {
  id         String   @id @default(cuid())
  propertyId String   @unique
  street     String?  @db.VarChar(255)
  city       String?  @db.VarChar(100)
  state      String?  @db.VarChar(100)
  zipCode    String?  @db.VarChar(20)
  country    String?  @db.VarChar(100)
  property   Property @relation(fields: [propertyId], references: [id])

  @@map("addresses")
}

model PropertyImage {
  id         String   @id @default(cuid())
  propertyId String
  url        String   @db.VarChar(1024)
  order      Int      @default(0)
  isPrimary  Boolean  @default(false)
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id])

  @@index([propertyId])
  @@map("property_images")
}

model Feature {
  id         String            @id @default(cuid())
  name       String            @unique @db.VarChar(100)
  properties PropertyFeature[]

  @@map("features")
}

model PropertyFeature {
  id         String   @id @default(cuid())
  propertyId String
  featureId  String
  feature    Feature  @relation(fields: [featureId], references: [id])
  property   Property @relation(fields: [propertyId], references: [id])

  @@unique([propertyId, featureId])
  @@index([featureId])
  @@map("property_features")
}

model Inquiry {
  id         String   @id @default(cuid())
  propertyId String
  userId     String?
  name       String   @db.VarChar(200)
  email      String   @db.VarChar(255)
  message    String   @db.Text
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id])
  user       User?    @relation(fields: [userId], references: [id])

  @@index([propertyId])
  @@index([userId])
  @@map("inquiries")
}

model Favorite {
  id         String   @id @default(cuid())
  userId     String
  propertyId String
  createdAt  DateTime @default(now())
  property   Property @relation(fields: [propertyId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@unique([userId, propertyId])
  @@index([propertyId])
  @@map("favorites")
}

model AdminConfig {
  id        String   @id @default(cuid())
  key       String   @unique @db.VarChar(100)
  value     String   @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admin_config")
}

model Conversation {
  id            String    @id @default(cuid())
  propertyId    String
  buyerId       String
  sellerId      String
  lastMessageAt DateTime  @default(now())
  createdAt     DateTime  @default(now())
  buyer         User      @relation("BuyerConversations", fields: [buyerId], references: [id], onDelete: Cascade)
  property      Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  seller        User      @relation("SellerConversations", fields: [sellerId], references: [id], onDelete: Cascade)
  messages      Message[]

  @@unique([propertyId, buyerId, sellerId])
  @@index([buyerId])
  @@index([sellerId])
  @@map("conversations")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  text           String       @db.Text
  isRead         Boolean      @default(false)
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@map("messages")
}

model AdminSettings {
  id        String   @id @default(cuid())
  key       String   @unique @db.VarChar(100)
  value     String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admin_settings")
}

model Review {
  id         String   @id @default(cuid())
  name       String   @db.VarChar(200)
  role       String   @db.VarChar(200)
  rating     Int      @default(5)
  text       String   @db.Text
  image      String?  @db.VarChar(1024)
  isApproved Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("reviews")
}